tinymce.PluginManager.add('gallery', function (editor, url) {
	

	var url          = '/redactor_albums/index';    // Экшен
	var body_class   = 'dialog-class';         // Класс контейнера диалогового окна
	var dialog_img   = 'img-fluid';           // Класс картинки в окне
	var dialog_title = 'Альбом';              // Титл окна
	var redactor_img = 'img-gallery';         // Класс картинки в редакторе
	var button_text  = 'Вставить из альбома'; // Текст кнопки
	
var gallery_list=[],images=[],load=function(a){return 0<gallery_list.length?a():($.ajax({url:url,type:"POST",async:!1,success:function(a){if(a&&"no_redactor"!=a.error&&"no_user"!=a.error)for(var b in a){var c="<img class=\""+dialog_img+"\"  title=\":"+b+":\" src=\"/upload/"+a[b].normal+"\"  />";images.push({text:b,value:b,icon:c}),gallery_list[b]=c}},dataType:"json"}),a())},openDialog=function(){return editor.windowManager.open({title:dialog_title,body:{type:"panel",classes:body_class,items:[{name:"results",type:"collection",columns:"auto"}]},initialData:{results:images,image_advtab:!0},onAction:function(a,b){$(gallery_list[b.value])[0].classList.remove(dialog_img);var c=gallery_list[b.value].replace(dialog_img,redactor_img);"results"===b.name&&(editor.insertContent(c),a.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]})};editor.ui.registry.addButton("gallery",{tooltip:"\u0418\u0437 \u0430\u043B\u044C\u0431\u043E\u043C\u0430",text:button_text,onAction:function(){load(openDialog)}});});